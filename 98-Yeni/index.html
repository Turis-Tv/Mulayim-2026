<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#071028" />

  <link rel="preconnect" href="https://www.youtube.com">
  <style>
    :root{
      --bg:#071028;
      --card: rgba(255,255,255,0.04);
      --muted:#9fb0c8;
      --accent1:#7b61ff;
      --accent2:#34d399;
      --glass: rgba(255,255,255,0.06);
      --text:#eaeef6;
      --big:18px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--text);background:var(--bg);-webkit-font-smoothing:antialiased}

    /* Layout */
    .wrap{display:flex;flex-direction:column;height:100vh;gap:10px;padding:12px;box-sizing:border-box}
    .topbar{display:flex;align-items:center;gap:10px}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .mark{width:44px;height:44;border-radius:10px;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700}
    .searchbar{flex:1}
    .searchbar input{width:100%;padding:12px 14px;border-radius:12px;border:0;background:rgba(255,255,255,0.03);color:var(--text);font-size:15px}

    /* Player */
    .player-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(6px);border-radius:14px;padding:8px;box-shadow:0 10px 30px rgba(2,6,23,0.6);display:flex;flex-direction:column;gap:8px}
    .video-wrap{position:relative;width:100%;aspect-ratio:16/9;border-radius:10px;overflow:hidden;background:#000}
    video, iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}

    /* Player controls (big touch targets) */
    .controls{display:flex;align-items:center;gap:8px}
    .btn{padding:12px;border-radius:12px;border:0;background:rgba(255,255,255,0.03);min-width:48px;min-height:48px;font-size:16px;display:flex;align-items:center;justify-content:center}
    .bigbtn{padding:12px 18px;border-radius:14px;font-weight:600}
    .title-row{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .title{font-size:16px;font-weight:600}
    .meta{font-size:12px;color:var(--muted)}

    /* Playlist - mobile carousel */
    .playlist{display:flex;gap:10px;overflow-x:auto;padding:8px 4px}
    .pl-item{min-width:140px;border-radius:10px;background:var(--card);padding:8px;flex:0 0 auto;cursor:pointer}

    /* collapsible sidebar for channels (bottom sheet on mobile) */
    .bottomsheet{position:fixed;left:12px;right:12px;bottom:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:8px;box-shadow:0 10px 40px rgba(2,6,23,0.6);max-height:55vh;overflow:auto}
    .sheet-handle{width:36px;height:4px;background:rgba(255,255,255,0.06);border-radius:10px;margin:6px auto}
    .channels{display:flex;flex-direction:column;gap:6px;padding-bottom:8px}
    .channel{display:flex;gap:8px;align-items:center;padding:8px;border-radius:10px}
    .channel img{width:72px;height:48px;object-fit:cover;border-radius:8px}

    /* responsive tweaks */
    @media(min-width:900px){
      .wrap{padding:24px}
      .layout-desktop{display:grid;grid-template-columns:320px 1fr;gap:18px;height:calc(100vh - 48px)}
      .sidebar{height:100%;overflow:auto}
      .bottomsheet{position:static;max-height:none}
      .playlist{padding:12px}
    }

    /* small scrollbar */
    .playlist::-webkit-scrollbar,.channels::-webkit-scrollbar{height:8px;width:8px}
    .playlist::-webkit-scrollbar-thumb,.channels::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.04);border-radius:10px}

    footer.note{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

    /* utility */
    .muted{color:var(--muted)}
    .controls-row{display:flex;gap:8px;align-items:center}
    .right-controls{display:flex;gap:6px;align-items:center}

  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="logo"><div class="mark"> </div><div style="line-height:1"><div style="font-weight:700"> </div><div style="font-size:12px;color:var(--muted)"> </div></div></div>
      <div class="searchbar"><input id="search" placeholder="Zoek..." aria-label="Zoek kanalen en titels" /></div>
      <button id="openSheet" class="btn" aria-label="Open kanalen">â˜°</button>
    </div>

    <div class="layout-desktop" style="flex:1;gap:12px">
      <aside class="sidebar player-card" style="display:none" id="sidebarDesktop">
        <div style="font-weight:700;margin-bottom:8px"> </div>
        <div class="channels" id="channelsDesktop"></div>
        <div style="margin-top:auto"><input id="newUrlDesk" placeholder="m3u8 of YouTube link" style="width:100%;padding:8px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:var(--text);margin-top:8px"/><button id="addDesk" class="btn" style="width:100%;margin-top:8px">Toevoegen</button></div>
      </aside>

      <main style="display:flex;flex-direction:column;gap:10px">
        <section class="player-card">
          <div class="title-row">
            <div>
              <div class="title" id="currentTitle">Bir kanal seÃ§in</div>
              <div class="meta" id="currentMeta">â€”</div>
            </div>
            <div class="right-controls">
              <button id="toggleLink" class="btn" title="Toon/Verberg link">ðŸ”’</button>
              <button id="toggleHtml" class="btn" title="HTML-weergave">&lt;/&gt;</button>
              <div style="display:flex;gap:8px;align-items:center">
                <button id="prev" class="btn" aria-label="Vorige">âŸ¨</button>
                <button id="playPause" class="bigbtn btn">Play</button>
                <button id="next" class="btn" aria-label="Volgende">âŸ©</button>
                <button id="fullscreen" class="btn" aria-label="Volledig scherm">â¤¢</button>
              </div>
            </div>
          </div>

          <div class="video-wrap" id="videoWrap">
            <video id="video" controls playsinline webkit-playsinline></video>
            <div id="yt-player" style="display:none"></div>
          </div>

          <div class="controls">
            <select id="quality" class="btn" aria-label="Kwaliteit"><option>Auto</option></select>
            <div style="flex:1"></div>
            <button id="pip" class="btn" aria-label="Picture-in-Picture">PiP</button>
          </div>
        </section>

        <section class="player-card" style="padding:8px">
          <div style="font-weight:700;margin-bottom:6px">Playlist</div>
          <div class="playlist" id="playlist"></div>
        </section>

        <section class="player-card" style="padding:8px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <div style="font-weight:700"> </div>
            <div style="font-size:12px;color:var(--muted)"> </div>
          </div>
          <div id="desc" style="color:var(--muted);font-size:14px"> </div>
        </section>
      </main>
    </div>

    <div id="sheet" class="bottomsheet" style="display:block" aria-hidden="false">
      <div class="sheet-handle"></div>
      <div style="display:flex;gap:8px;padding:8px"><input id="newUrl" placeholder="m3u8 of YouTube link" style="flex:1;padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:var(--text)"/><button id="addBtn" class="btn">+</button></div>
      <div class="channels" id="channels"></div>
    </div>

    <footer class="note"> </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
  <script>
    // --- data ---
    const playlist = [    
      {id:1,type:'hls',url:'https://live.duhnet.tv/S2/HLS_LIVE/eurodnp/track_3_750/playlist.m3u8',title:'Test HLS - Mux',logo:'https://picsum.photos/200/120?random=11', description:'Test stream from Mux.'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=6N8_r2uwLEc',title:'YouTube Demo',logo:'https://i.ytimg.com/vi/M7lc1UVf-VE/hqdefault.jpg', description:'YouTube demo video.'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=JjTeViaVdoI',title:'Evlerinin Ã–nÃ¼ ',logo:'https://img.youtube.com/vi/JjTeViaVdoI/maxresdefault.jpg', description:'Evlerinin Ã–nÃ¼'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=c1h68yMxb3I',title:'Makaram SarÄ± BaÄŸlar',logo:'https://img.youtube.com/vi/c1h68yMxb3I/maxresdefault.jpg', description:'Makaram SarÄ± BaÄŸlar'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=Mwu43X40PgE',title:'Lorke Lorke',logo:'https://img.youtube.com/vi/Mwu43X40PgE/maxresdefault.jpg', description:'Lorke Lorke'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=qaxtyajdjmc',title:'Kar YaÄŸar',logo:'https://img.youtube.com/vi/qaxtyajdjmc/maxresdefault.jpg', description:'Kar YaÄŸar'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=bjFjXCkEIzQ',title:'Evlerinin Ã–nÃ¼',logo:'https://img.youtube.com/vi/bjFjXCkEIzQ/maxresdefault.jpg', description:'Evlerinin Ã–nÃ¼'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=JW5W2kVLxAA',title:'Ä°ÄŸne AttÄ±m',logo:'https://img.youtube.com/vi/JW5W2kVLxAA/maxresdefault.jpg', description:'Ä°ÄŸne AttÄ±m'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=JRg5_qcx6es',title:'HazalÄ±m',logo:'https://img.youtube.com/vi/JRg5_qcx6es/maxresdefault.jpg', description:'HazalÄ±m'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=1O00V1XmxXw',title:'Ne GÃ¼zel YaratmÄ±ÅŸ',logo:'https://img.youtube.com/vi/1O00V1XmxXw/maxresdefault.jpg', description:'Ne GÃ¼zel YaratmÄ±ÅŸ'},
      {id:2,type:'youtube',url:'https://www.youtube.com/watch?v=1uhBfgCGtdo',title:'DelalÄ±m',logo:'https://img.youtube.com/vi/1uhBfgCGtdo/maxresdefault.jpg', description:'DelalÄ±m'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=byUuAxjfP2M',title:'Emminem',logo:'https://img.youtube.com/vi/byUuAxjfP2M/maxresdefault.jpg', description:'Emminem'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=L3AJYq1BwUA',title:'GÃ¶zÃ¼ndeki YaÅŸlarÄ±na',logo:'https://img.youtube.com/vi/L3AJYq1BwUA/maxresdefault.jpg', description:'GÃ¶zÃ¼ndeki YaÅŸlarÄ±na'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=Ae2uE9_m73I',title:'BaÅŸÄ±ndaki PoÅŸu mudur',logo:'https://img.youtube.com/vi/Ae2uE9_m73I/maxresdefault.jpg', description:'BaÅŸÄ±ndaki PoÅŸu mudur'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=bbYjyvwAfhU',title:'Duydunuz mu',logo:'https://img.youtube.com/vi/bbYjyvwAfhU/maxresdefault.jpg', description:'Duydunuz mu'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=Bv3GSlGqI4c',title:'Zor imiÅŸ MeÄŸer',logo:'https://img.youtube.com/vi/Bv3GSlGqI4c/maxresdefault.jpg', description:'Zor imiÅŸ MeÄŸer'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=vOF0rpRK3ow',title:'AlsÄ±n Beni Benden',logo:'https://img.youtube.com/vi/vOF0rpRK3ow/maxresdefault.jpg', description:'AlsÄ±n Beni Benden'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=MqV55hD0Sv4',title:'O Yar Gelir',logo:'https://img.youtube.com/vi/MqV55hD0Sv4/maxresdefault.jpg', description:'O Yar Gelir'},
      {id:2,type:'youtube',url:'https://www.yout-ube.com/watch?v=YByNhFSYWw4',title:'SigaramÄ±n DumanÄ±',logo:'https://img.youtube.com/vi/YByNhFSYWw4/maxresdefault.jpg', description:'SigaramÄ±n DumanÄ±'},
      {id:4,type:'hls',url:'http://12204.vod.adultiptv.net/ph58657d939d860/play.m3u8',title:'Sintel HLS',logo:'https://picsum.photos/200/120?random=3', description:'Sintel sample HLS.'}
    ];

    // --- refs ---
    const channelsEl = document.getElementById('channels');
    const channelsDesktopEl = document.getElementById('channelsDesktop');
    const playlistEl = document.getElementById('playlist');
    const video = document.getElementById('video');
    const ytContainer = document.getElementById('yt-player');
    const currentTitle = document.getElementById('currentTitle');
    const currentMeta = document.getElementById('currentMeta');
    const desc = document.getElementById('desc');
    const sheet = document.getElementById('sheet');
    const toggleLinkBtn = document.getElementById('toggleLink');
    const toggleHtmlBtn = document.getElementById('toggleHtml');

    let currentIndex = -1; let hls; let ytPlayer; let linksHidden = true; let htmlMode = false;

    function escapeHTML(str){ return String(str).replace(/[&<>"']/g, function(s){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[s];}); }

    // simple sanitizer that allows a few tags (a, b, i, br, p)
    function sanitizeHtml(unsafe){ const parser = new DOMParser(); const doc = parser.parseFromString(unsafe,'text/html'); const allowed = ['A','B','I','BR','P'];
      function clean(node){ const children = Array.from(node.childNodes); children.forEach(c=>{ if(c.nodeType===1){ if(!allowed.includes(c.nodeName)){
            // unwrap: replace node with its children
            while(c.firstChild) node.insertBefore(c.firstChild,c);
            node.removeChild(c);
          } else {
            // keep but sanitize attributes on links
            if(c.nodeName==='A'){ const href=c.getAttribute('href')||''; c.setAttribute('href',href); c.setAttribute('target','_blank'); }
            clean(c);
          }
        } else if(c.nodeType===3){ /* text node ok */ }
      }) }
      clean(doc.body);
      return doc.body.innerHTML;
    }

    function makeChannelEl(ch, idx){
      const el = document.createElement('div'); el.className='channel'; el.dataset.index=idx;
      el.innerHTML = `<img src="${ch.logo||'https://picsum.photos/200/120'}" alt="logo"><div style="display:flex;flex-direction:column"><div style="font-weight:600">${escapeHTML(ch.title)}</div><div style="font-size:12px;color:var(--muted)">${escapeHTML(ch.type.toUpperCase())}</div></div>`;
      el.addEventListener('click',()=>{ playIndex(idx); if(window.innerWidth<900) toggleSheet(false); });
      return el;
    }

    function renderChannels(filter=''){
      channelsEl.innerHTML=''; channelsDesktopEl.innerHTML='';
      playlist.forEach((ch,idx)=>{ if(filter && !ch.title.toLowerCase().includes(filter) && !ch.type.includes(filter)) return; channelsEl.appendChild(makeChannelEl(ch,idx)); channelsDesktopEl.appendChild(makeChannelEl(ch,idx)); });
    }

    function renderPlaylist(){ playlistEl.innerHTML=''; playlist.forEach((it,idx)=>{ const item = document.createElement('div'); item.className='pl-item'; item.innerHTML=`<img src="${it.logo||'https://picsum.photos/200/120'}" style="width:100%;height:80px;object-fit:cover;border-radius:6px;margin-bottom:6px"><div style="font-weight:600">${escapeHTML(it.title)}</div><div style="font-size:12px;color:var(--muted)">${escapeHTML(it.type)}</div>`; item.addEventListener('click',()=>playIndex(idx)); playlistEl.appendChild(item); }); }

    // play index (HLS or YouTube)
    function playIndex(i){ if(i<0||i>=playlist.length) return; const item = playlist[i]; currentIndex=i; currentTitle.textContent=item.title; currentMeta.textContent = item.type.toUpperCase();
      // show description (without URL by default)
      if(item.description){ setDescription(item.description); } else { setDescription(''); }

      if(item.type==='youtube'){
        video.style.display='none'; ytContainer.style.display='block'; const videoId = parseYouTubeID(item.url);
        if(!ytPlayer){ if(typeof YT==='undefined'){ const tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';document.body.appendChild(tag); window.onYouTubeIframeAPIReady = ()=>{ ytPlayer = new YT.Player('yt-player',{videoId,playerVars:{autoplay:1,controls:1}}); } } else { ytPlayer = new YT.Player('yt-player',{videoId,playerVars:{autoplay:1,controls:1}}); } } else { ytPlayer.loadVideoById(videoId); }
      } else {
        ytContainer.style.display='none'; video.style.display='block'; video.pause(); if(hls){hls.destroy();hls=null}
        if(Hls.isSupported()){
          hls = new Hls(); hls.loadSource(item.url); hls.attachMedia(video); hls.on(Hls.Events.MANIFEST_PARSED, ()=>{ video.play(); updateQualityOptions(); });
        } else if(video.canPlayType('application/vnd.apple.mpegurl')){ video.src=item.url; video.addEventListener('loadedmetadata',()=>video.play()); } else { alert('HLS niet ondersteund'); }
      }
      highlightActive();

      // store last item's url hidden - used when user clicks 'toon link'
      desc.dataset.url = item.url || '';
      desc.dataset.html = item.html || '';
    }

    function setDescription(text){ if(htmlMode){ desc.innerHTML = sanitizeHtml(text); } else { desc.textContent = text; }
      if(linksHidden){ // remove any plain urls from showing
        // simple url regex to hide
        desc.innerHTML = desc.innerHTML.replace(/https?:\/\/[\w\-\.\/%\?=&#]+/g,'[link verborgen]');
      }
    }

    function updateQualityOptions(){ const q=document.getElementById('quality'); q.innerHTML=''; if(!hls||!hls.levels){ q.innerHTML='<option>Auto</option>'; return;} const auto=document.createElement('option'); auto.textContent='Auto'; q.appendChild(auto); hls.levels.forEach((lvl,idx)=>{ const o=document.createElement('option'); o.value=idx; o.textContent=(lvl.height?lvl.height+'p ':'')+(lvl.bitrate?Math.round(lvl.bitrate/1000)+'kbps':''); q.appendChild(o); }); q.onchange=()=>{ const v=q.value; if(v==='Auto') hls.currentLevel=-1; else hls.currentLevel=parseInt(v); } }

    function highlightActive(){ document.querySelectorAll('.channel').forEach((el,idx)=>{ el.style.outline = (idx===currentIndex)?'2px solid rgba(123,97,255,0.18)':'none' }); document.querySelectorAll('.pl-item').forEach((el,idx)=>{ el.style.opacity = (idx===currentIndex)?'1':'0.85' }); }

    function parseYouTubeID(url){ const m = url.match(/(v=|youtu\.be\/|embed\/)([A-Za-z0-9_-]{6,})/); return m?m[2]:url; }

    // controls
    document.getElementById('playPause').addEventListener('click',()=>{ if(ytContainer.style.display!=='none' && ytPlayer){ const state = ytPlayer.getPlayerState(); if(state===1) ytPlayer.pauseVideo(); else ytPlayer.playVideo(); } else { if(video.paused) video.play(); else video.pause(); } });
    document.getElementById('prev').addEventListener('click',()=>playIndex((currentIndex-1+playlist.length)%playlist.length));
    document.getElementById('next').addEventListener('click',()=>playIndex((currentIndex+1)%playlist.length));

    // fullscreen button
    document.getElementById('fullscreen').addEventListener('click',()=>{ const el = document.getElementById('videoWrap'); if(!document.fullscreenElement) el.requestFullscreen?.(); else document.exitFullscreen?.(); });

    // Picture-in-Picture
    document.getElementById('pip').addEventListener('click',async ()=>{ try{ if(document.pictureInPictureElement) await document.exitPictureInPicture(); else await video.requestPictureInPicture(); }catch(e){alert('PiP niet beschikbaar');} });

    // add url
    document.getElementById('addBtn').addEventListener('click',()=>{ const val=document.getElementById('newUrl').value.trim(); if(!val) return; const type = val.includes('youtube')||val.includes('youtu.be') ? 'youtube' : (val.endsWith('.m3u8')||val.includes('m3u8') ? 'hls' : 'hls'); playlist.push({id:Date.now(),type,url:val,title:val,logo:'https://picsum.photos/200/120?random='+Math.floor(Math.random()*999),description:''}); renderChannels(document.getElementById('search').value.toLowerCase()); renderPlaylist(); document.getElementById('newUrl').value=''; });
    document.getElementById('addDesk').addEventListener('click',()=>{ const val=document.getElementById('newUrlDesk').value.trim(); if(!val) return; playlist.push({id:Date.now(),type:val.includes('youtube')?'youtube':'hls',url:val,title:val,logo:'https://picsum.photos/200/120?random='+Math.floor(Math.random()*999),description:''}); renderChannels(document.getElementById('search').value.toLowerCase()); renderPlaylist(); document.getElementById('newUrlDesk').value=''; });

    document.getElementById('search').addEventListener('input',(e)=>renderChannels(e.target.value.toLowerCase()));

    // sheet toggle
    document.getElementById('openSheet').addEventListener('click',()=>toggleSheet());
    function toggleSheet(show){ if(show===undefined) show = (sheet.style.display==='none'); sheet.style.display = show ? 'block' : 'none'; sheet.setAttribute('aria-hidden', !show); }

    // toggle link visibility
    toggleLinkBtn.addEventListener('click', ()=>{ linksHidden = !linksHidden; toggleLinkBtn.textContent = linksHidden ? 'ðŸ”’' : 'ðŸ”“'; if(currentIndex>=0){ const item = playlist[currentIndex]; setDescription(htmlMode? (item.description||'') : (item.description||'')); // re-render
        // if user wants to see the url directly, show a small temporary reveal
        if(!linksHidden){ const url = desc.dataset.url || ''; if(url) desc.innerHTML = (htmlMode? sanitizeHtml(desc.innerHTML): escapeHTML(desc.innerHTML)) + `<div style="margin-top:6px;font-size:12px"><a href="${escapeHTML(url)}" target="_blank">Open link</a></div>`; }
      }
    });

    // toggle html mode
    toggleHtmlBtn.addEventListener('click', ()=>{ htmlMode = !htmlMode; toggleHtmlBtn.style.opacity = htmlMode ? '1' : '0.7'; if(currentIndex>=0){ const item = playlist[currentIndex]; const text = item.description || ''; setDescription(text); } });

    // keyboard mobile friendly
    window.addEventListener('keydown',e=>{ if(e.code==='Space'){ e.preventDefault(); document.getElementById('playPause').click(); } });

    // initial render
    renderChannels(); renderPlaylist();

    // improve touch area: make video double-tap to toggle fullscreen
    let lastTap = 0; document.getElementById('videoWrap').addEventListener('touchend', (e)=>{ const cur = Date.now(); if(cur - lastTap < 300){ document.getElementById('fullscreen').click(); } lastTap = cur; });

    // autoplay on rotate to landscape for better experience
    window.addEventListener('orientationchange', ()=>{ if(window.orientation===90||window.orientation===-90){ /* landscape */ if(currentIndex>=0) { const el = document.getElementById('videoWrap'); el.requestFullscreen?.(); } } });

  </script>
</body>
</html>
